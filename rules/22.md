
\subsection{Rule 22 - Use secure random number generators for cryptographic keys} 
\textbf{Google guideline.} 
\emph{Use a secure random number generator, \texttt{SecureRandom}, to initialize any cryptographic keys generated by \texttt{KeyGenerator}. Use of a key that is not generated with a secure random number generator significantly weakens the strength of the algorithm and may allow offline attacks.
\\
If you need to store a key for repeated use, use a mechanism, such as \texttt{KeyStore}, that provides a mechanism for long term storage and retrieval of cryptographic keys.}

\textbf{Rule design.} The logic of Rule 22 is shown in Algorithm~\ref{algorithm22}. We look for KeyGenerator objects in the code of the app. If any of these objects is non initialized using a secure random number generator, we cosider it a violation to the rule. 

\setcounter{algocf}{21}
\begin{algorithm}[]
\SetAlgoLined
\Begin{
    \texttt{keyGens} $\leftarrow$ getAllKeyGenVars()\\
    \texttt{secRands} $\leftarrow$ getAllSecRandVars()\\
	\ForEach{\upshape \texttt{keyGen} \textbf{in} \texttt{keyGens}}{
	    \SetAlgoNoLine{\If{\upshape \textbf{not} initsWithAny(\texttt{keyGen}, \texttt{secRands})}{
	           \emph{Rule 22 is not respected.}
	    }}
	}
}
\caption{\change{Use cryptography}}
\label{algorithm22}
\end{algorithm}

\textbf{Attack.} When keys are not generated through secure random number generators, a malicious app can infer the value of such keys and decrypt any sensitive data previously encrypted by the legitimate app. 
